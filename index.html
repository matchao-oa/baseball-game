<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìˆ«ì ì•¼êµ¬ ë©€í‹°í”Œë ˆì´</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #f0f8f5; padding-top: 50px; }
        .container { background: white; padding: 20px; border-radius: 15px; display: inline-block; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { padding: 10px; font-size: 16px; width: 100px; border: 2px solid #3cb371; border-radius: 5px; }
        button { padding: 10px 20px; font-size: 16px; background-color: #ddffdd; color: #444447; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:disabled { background-color: #ccc; }
        #status { margin: 20px; font-weight: bold; color: #2e8b57; }
        #log { margin-top: 20px; text-align: left; max-height: 200px; overflow-y: auto; padding: 10px; border-top: 1px solid #eee; font-size: 14px; }
    </style>
</head>
<body>

<div class="container">
    <h2>âš¾ï¸ ì»¤ìŠ¤í…€ ìˆ«ì ì•¼êµ¬</h2>
    <div id="setup">
        <button onclick="joinGame()">ê²Œì„ ì…ì¥í•˜ê¸°</button>
    </div>

    <div id="game-area" style="display:none;">
        <div id="status">ëŒ€ê¸° ì¤‘...</div>
        <div id="input-section">
            <input type="text" id="numberInput" maxlength="3" placeholder="3ìë¦¬ ìˆ«ì">
            <button id="actionBtn" onclick="handleAction()">í™•ì¸</button>
        </div>
        <div id="log"></div>
    </div>
</div>

<script>
    // ìœ ì €ë‹˜ì˜ ì§„ì§œ Firebase ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!
    const firebaseConfig = {
        apiKey: "AIzaSyBUAnG4KmuGAY0JCVzreb0o5XZd4qjJAZA",
        authDomain: "bullsandcows1004.firebaseapp.com",
        databaseURL: "https://bullsandcows1004-default-rtdb.firebaseio.com",
        projectId: "bullsandcows1004",
        storageBucket: "bullsandcows1004.firebasestorage.app",
        messagingSenderId: "191843667458",
        appId: "1:191843667458:web:a01e29f4883e8168e2211b",
        measurementId: "G-48WXZP73B7"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let myRole = ""; 
    let gameId = "room1"; 
    let gameState = {};

    function joinGame() {
        db.ref('rooms/' + gameId).get().then((snapshot) => {
            const data = snapshot.val();
            if (!data || !data.player1) {
                myRole = "player1";
                db.ref('rooms/' + gameId + '/player1').set({ id: "p1", ready: false });
            } else if (!data.player2) {
                myRole = "player2";
                db.ref('rooms/' + gameId + '/player2').set({ id: "p2", ready: false });
            } else {
                alert("ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.");
                return;
            }
            document.getElementById('setup').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            listenGame();
        });
    }

    function listenGame() {
        db.ref('rooms/' + gameId).on('value', (snapshot) => {
            gameState = snapshot.val() || {};
            const status = document.getElementById('status');
            const btn = document.getElementById('actionBtn');

            if (!gameState.player2) {
                status.innerText = "ìƒëŒ€ë°©ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...";
                btn.disabled = true;
            } else if (!gameState.player1.ready || !gameState.player2.ready) {
                const myReady = gameState[myRole].ready;
                status.innerText = myReady ? "ìƒëŒ€ë°©ì´ ìˆ«ìë¥¼ ê³ ë¥´ê³  ìˆìŠµë‹ˆë‹¤..." : "ìƒëŒ€ë°©ì—ê²Œ ìˆ¨ê¸¸ ë‚˜ì˜ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”!";
                btn.disabled = myReady;
                btn.innerText = "ìˆ«ì ì„¤ì •";
            } else {
                btn.innerText = "ê³µê²©!";
                if (gameState.turn === myRole) {
                    status.innerText = "ğŸ”¥ ë‹¹ì‹ ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤! ìƒëŒ€ì˜ ìˆ«ìë¥¼ ë§í˜€ë³´ì„¸ìš”.";
                    btn.disabled = false;
                } else {
                    status.innerText = "ğŸ’¤ ìƒëŒ€ë°©ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤...";
                    btn.disabled = true;
                }
            }
        });
    }

    function handleAction() {
        const val = document.getElementById('numberInput').value;
        if (val.length !== 3 || isNaN(val)) return alert("3ìë¦¬ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”!");

        if (!gameState[myRole].ready) {
            db.ref('rooms/' + gameId + '/' + myRole).update({
                ready: true,
                secret: val
            });
            if (myRole === "player2") db.ref('rooms/' + gameId).update({ turn: "player1" });
            document.getElementById('numberInput').value = "";
            addLog(`âœ… ë‚˜ì˜ ìˆ˜ë¹„ ìˆ«ì [${val}] ì„¤ì • ì™„ë£Œ!`);
        } else {
            const opponentRole = myRole === "player1" ? "player2" : "player1";
            const target = gameState[opponentRole].secret;
            const result = checkScore(val, target);
            
            addLog(`ğŸš€ ë‚˜ì˜ ê³µê²© [${val}]: ${result}`);
            
            if (result === "3 ìŠ¤íŠ¸ë¼ì´í¬! í™ˆëŸ°!") {
                alert("ì¶•í•˜í•©ë‹ˆë‹¤! ìŠ¹ë¦¬í•˜ì…¨ìŠµë‹ˆë‹¤!");
                db.ref('rooms/' + gameId).remove(); 
                location.reload();
            } else {
                db.ref('rooms/' + gameId).update({ turn: opponentRole });
            }
            document.getElementById('numberInput').value = "";
        }
    }

    function checkScore(input, target) {
        let s = 0, b = 0;
        for (let i = 0; i < 3; i++) {
            if (input[i] === target[i]) s++;
            else if (target.includes(input[i])) b++;
        }
        if (s === 3) return "3 ìŠ¤íŠ¸ë¼ì´í¬! í™ˆëŸ°!";
        return `${s}S ${b}B`;
    }

    function addLog(msg) {
        const log = document.getElementById('log');
        log.innerHTML = `<div>${msg}</div>` + log.innerHTML;
    }
</script>

</body>
</html>